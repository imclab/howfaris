!function(b){var c=function(e,d){this.$element=b(e);this.options=b.extend(true,{},b.fn.typeahead.defaults,d);this.$menu=b(this.options.menu).appendTo("body");this.shown=false;this.eventSupported=this.options.eventSupported||this.eventSupported;this.grepper=this.options.grepper||this.grepper;this.highlighter=this.options.highlighter||this.highlighter;this.lookup=this.options.lookup||this.lookup;this.matcher=this.options.matcher||this.matcher;this.render=this.options.render||this.render;this.select=this.options.select||this.select;this.sorter=this.options.sorter||this.sorter;this.source=this.options.source||this.source;if(!this.source.length){var f=this.options.ajax;if(typeof f==="string"){this.ajax=b.extend({},b.fn.typeahead.defaults.ajax,{url:f})}else{this.ajax=b.extend({},b.fn.typeahead.defaults.ajax,f)}if(!this.ajax.url){this.ajax=null}}this.listen()};var a=(function(){var d=/[àáâãäåæçèéêëìíîïñòóôõöœùúûüýÿþ]/g;return function(e){var f={"à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","æ":"ae","ç":"c","è":"e","é":"e","ê":"e","ë":"e","ì":"i","í":"i","î":"i","ï":"i","ñ":"n","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","œ":"oe","ù":"u","ú":"u","û":"u","ü":"u","ý":"y","ÿ":"y","þ":"th"};return(e.replace(d,function(g){return f[g]}))}})();c.prototype={constructor:c,eventSupported:function(d){var e=(d in this.$element);if(!e){this.$element.setAttribute(d,"return;");e=typeof this.$element[d]==="function"}return e},ajaxer:function(){var d=this,e=d.$element.val();if(e===d.query){return d}d.query=e;if(d.ajax.timerId){clearTimeout(d.ajax.timerId);d.ajax.timerId=null}if(!e||e.length<d.ajax.triggerLength){if(d.ajax.xhr){d.ajax.xhr.abort();d.ajax.xhr=null;d.ajaxToggleLoadClass(false)}return d.shown?d.hide():d}d.ajax.timerId=setTimeout(function(){b.proxy(d.ajaxExecute(e),d)},d.ajax.timeout);return d},ajaxExecute:function(e){this.ajaxToggleLoadClass(true);if(this.ajax.xhr){this.ajax.xhr.abort()}var f=this.ajax.preDispatch?this.ajax.preDispatch(e):{query:e};var d=(this.ajax.method==="post")?b.post:b.get;this.ajax.xhr=d(this.ajax.url,f,b.proxy(this.ajaxLookup,this));this.ajax.timerId=null},ajaxLookup:function(e){var d;this.ajaxToggleLoadClass(false);if(!this.ajax.xhr){return}if(this.ajax.preProcess){e=this.ajax.preProcess(e)}this.ajax.data=e;d=this.grepper(this.ajax.data);if(!d||!d.length){return this.shown?this.hide():this}this.ajax.xhr=null;return this.render(d.slice(0,this.options.items)).show()},ajaxToggleLoadClass:function(d){if(!this.ajax.loadingClass){return}this.$element.toggleClass(this.ajax.loadingClass,d)},lookup:function(f){var e=this,d;if(e.ajax){e.ajaxer()}else{e.query=e.$element.val();if(!e.query){return e.shown?e.hide():e}d=e.grepper(e.source);if(!d||!d.length){return e.shown?e.hide():e}return e.render(d.slice(0,e.options.items)).show()}},grepper:function(f){var e=this,d;if(f&&f.length&&!f[0].hasOwnProperty(e.options.display)){return null}d=b.grep(f,function(g){return e.matcher(g[e.options.display],g)});return this.sorter(d)},matcher:function(d){return ~a(d.toLowerCase()).indexOf(a(this.query.toLowerCase()))},sorter:function(f){var i=this,g=[],e=[],d=[],h;while(h=f.shift()){if(!h[i.options.display].toLowerCase().indexOf(this.query.toLowerCase())){g.push(h)}else{if(~h[i.options.display].indexOf(this.query)){e.push(h)}else{d.push(h)}}}return g.concat(e,d)},show:function(){var d=b.extend({},this.$element.offset(),{height:this.$element[0].offsetHeight});this.$menu.css({top:d.top+d.height,left:d.left});this.$menu.show();this.shown=true;return this},hide:function(){this.$menu.hide();this.shown=false;return this},highlighter:function(d){var e=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return d.replace(new RegExp("("+e+")","ig"),function(f,g){return"<strong>"+g+"</strong>"})},render:function(d){var e=this;d=b(d).map(function(f,g){f=b(e.options.item).attr("data-value",g[e.options.val]);f.find("a").html(e.highlighter(g[e.options.display],g));return f[0]});d.first().addClass("active");this.$menu.html(d);return this},select:function(){var d=this.$menu.find(".active");this.$element.val(d.text()).change();this.options.itemSelected(d,d.attr("data-value"),d.text());return this.hide()},next:function(e){var f=this.$menu.find(".active").removeClass("active");var d=f.next();if(!d.length){d=b(this.$menu.find("li")[0])}d.addClass("active")},prev:function(e){var f=this.$menu.find(".active").removeClass("active");var d=f.prev();if(!d.length){d=this.$menu.find("li").last()}d.addClass("active")},listen:function(){this.$element.on("blur",b.proxy(this.blur,this)).on("keyup",b.proxy(this.keyup,this));if(this.eventSupported("keydown")){this.$element.on("keydown",b.proxy(this.keypress,this))}else{this.$element.on("keypress",b.proxy(this.keypress,this))}this.$menu.on("click",b.proxy(this.click,this)).on("mouseenter","li",b.proxy(this.mouseenter,this))},keyup:function(d){d.stopPropagation();d.preventDefault();switch(d.keyCode){case 40:case 38:break;case 9:case 13:if(!this.shown){return}this.select();break;case 27:this.hide();break;default:this.lookup()}},keypress:function(d){d.stopPropagation();if(!this.shown){return}switch(d.keyCode){case 9:case 13:case 27:d.preventDefault();break;case 38:d.preventDefault();this.prev();break;case 40:d.preventDefault();this.next();break}},blur:function(f){var d=this;f.stopPropagation();f.preventDefault();setTimeout(function(){if(!d.$menu.is(":focus")){d.hide()}},150)},click:function(d){d.stopPropagation();d.preventDefault();this.select()},mouseenter:function(d){this.$menu.find(".active").removeClass("active");b(d.currentTarget).addClass("active")}};b.fn.typeahead=function(d){return this.each(function(){var g=b(this),f=g.data("typeahead"),e=typeof d==="object"&&d;if(!f){g.data("typeahead",(f=new c(this,e)))}if(typeof d==="string"){f[d]()}})};b.fn.typeahead.defaults={source:[],items:8,menu:'<ul class="typeahead dropdown-menu"></ul>',item:'<li><a href="#"></a></li>',display:"name",val:"id",itemSelected:function(){},ajax:{url:null,timeout:300,method:"post",triggerLength:3,loadingClass:null,displayField:null,preDispatch:null,preProcess:null}};b.fn.typeahead.Constructor=c;b(function(){b("body").on("focus.typeahead.data-api",'[data-provide="typeahead"]',function(f){var d=b(this);if(d.data("typeahead")){return}f.preventDefault();d.typeahead(d.data())})})}(window.jQuery);
